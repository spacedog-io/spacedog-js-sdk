(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
    typeof define === 'function' && define.amd ? define(factory) :
    (global.SpaceDog = factory());
}(this, (function () { 'use strict';

var Config = {

    backendId: null,

    default_authorization_header: null

};

var UrlBuilder = {
    forLogin: function forLogin() {
        return 'https://' + Config.backendId + '.spacedog.io/1/login';
    },
    forSearch: function forSearch(type) {
        return 'https://' + Config.backendId + '.spacedog.io/1/search/' + type;
    }
};

var Credentials = {
    /**
     * opts : { username:string, password:string, rememberMe:bool }
     * cb : callback function
     */
    login: function login(opts, cb) {

        var data = JSON.stringify({});

        var xhr = new XMLHttpRequest();

        var url = UrlBuilder.forLogin();

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                try {
                    var json = JSON.parse(xhr.responseText);

                    if (!json.success) {

                        cb(json, null);
                    } else {

                        Config.default_authorization_header = "Bearer " + json.accessToken;
                        if (opts.rememberMe) {
                            localStorage.setItem('SPACEDOG_CREDENTIALS_TOKEN', json.accessToken);
                        }
                        cb(null, json);
                    }
                } catch (e) {
                    console.warn("SpaceDog.Credentials# could not parse xhr.responseText and therefore not able to 1/ set authorization headers 2/ remember user token, if rememberMe is true ; caught execotuion:", e);
                    cb(null, xhr.responseText);
                }
            }
        };

        xhr.open("GET", url);
        try {
            xhr.setRequestHeader("Authorization", "Basic " + new Buffer(opts.username + ":" + opts.password).toString('base64'));
        } catch (e) {
            xhr.setRequestHeader("Authorization", "Basic " + btoa(opts.username + ":" + opts.password));
        }

        xhr.send(data);
    },
    canTryLogin: function canTryLogin() {
        return localStorage.getItem('SPACEDOG_CREDENTIALS_TOKEN') != undefined && localStorage.getItem('SPACEDOG_CREDENTIALS_TOKEN') != null;
    }
};

var Data = {

    /**
     * opts : { type:string }
     * cb : callback function
     */
    search: function search(opts, cb) {

        var data = JSON.stringify({});

        var xhr = new XMLHttpRequest();

        var url = UrlBuilder.forSearch(opts.type);

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                try {
                    cb(null, JSON.parse(xhr.responseText));
                } catch (e) {
                    cb(null, xhr.responseText);
                }
            }
        };

        xhr.open("POST", url);
        xhr.setRequestHeader("content-type", "application/json");
        // TEST, to remove after we can update acl (see issue https://github.com/spacedog-io/spacedog-server/issues/54)
        //xhr.setRequestHeader("authorization", "Basic ZHVtbXliYWNrZW5kOmhpIGR1bW15YmFja2VuZA==");

        xhr.send(data);
    }
};

var SpaceDog = {
    initialize: function initialize(backendId) {
        if (backendId == undefined) {
            throw "BackendId is required.";
        }
        Config.backendId = backendId;
    },
    getBackendId: function getBackendId() {
        return Config.backendId;
    },
    forgetAll: function forgetAll() {
        Config.backendId = null;
        Config.default_authorization_header = null;
    }
};

SpaceDog._Config = Config; // pas en release ?
SpaceDog.Credentials = Credentials;
SpaceDog.Data = Data;

return SpaceDog;

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbInNyYy9saWIvY29uZmlnLmpzIiwic3JjL2xpYi91cmxCdWlsZGVyLmpzIiwic3JjL2xpYi9jcmVkZW50aWFscy5qcyIsInNyYy9saWIvZGF0YS5qcyIsInNyYy9zcGFjZWRvZy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCB7XG5cbiAgICBiYWNrZW5kSWQ6bnVsbCxcblxuICAgIGRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXI6bnVsbFxuXG59IiwiaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZy5qcydcblxuXG5leHBvcnQgZGVmYXVsdCB7XG5cbiAgICBmb3JMb2dpbiAoKSB7XG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly8ke0NvbmZpZy5iYWNrZW5kSWR9LnNwYWNlZG9nLmlvLzEvbG9naW5gXG4gICAgfSxcblxuXG4gICAgZm9yU2VhcmNoICh0eXBlKSB7XG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly8ke0NvbmZpZy5iYWNrZW5kSWR9LnNwYWNlZG9nLmlvLzEvc2VhcmNoL2ArdHlwZVxuICAgIH1cblxuXG5cbn0iLCJpbXBvcnQgVXJsQnVpbGRlciBmcm9tICcuL3VybEJ1aWxkZXIuanMnXG5pbXBvcnQgQ29uZmlnIGZyb20gJy4vY29uZmlnLmpzJ1xuXG5leHBvcnQgZGVmYXVsdCB7XG4gICAgLyoqXG4gICAgICogb3B0cyA6IHsgdXNlcm5hbWU6c3RyaW5nLCBwYXNzd29yZDpzdHJpbmcsIHJlbWVtYmVyTWU6Ym9vbCB9XG4gICAgICogY2IgOiBjYWxsYmFjayBmdW5jdGlvblxuICAgICAqL1xuICAgIGxvZ2luIChvcHRzLCBjYikge1xuXG4gICAgICAgIHZhciBkYXRhID0gSlNPTi5zdHJpbmdpZnkoe30pO1xuXG4gICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblxuICAgICAgICB2YXIgdXJsID0gVXJsQnVpbGRlci5mb3JMb2dpbigpO1xuXG4gICAgICAgIHhoci5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHZhciBqc29uID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcblxuICAgICAgICAgICAgICAgIGlmICghanNvbi5zdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgY2IoanNvbiwgbnVsbClcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBDb25maWcuZGVmYXVsdF9hdXRob3JpemF0aW9uX2hlYWRlciA9IFwiQmVhcmVyIFwiK2pzb24uYWNjZXNzVG9rZW5cbiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdHMucmVtZW1iZXJNZSkge1xuICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdTUEFDRURPR19DUkVERU5USUFMU19UT0tFTicsIGpzb24uYWNjZXNzVG9rZW4pXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2IobnVsbCwganNvbilcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXCJTcGFjZURvZy5DcmVkZW50aWFscyMgY291bGQgbm90IHBhcnNlIHhoci5yZXNwb25zZVRleHQgYW5kIHRoZXJlZm9yZSBub3QgYWJsZSB0byAxLyBzZXQgYXV0aG9yaXphdGlvbiBoZWFkZXJzIDIvIHJlbWVtYmVyIHVzZXIgdG9rZW4sIGlmIHJlbWVtYmVyTWUgaXMgdHJ1ZSA7IGNhdWdodCBleGVjb3R1aW9uOlwiLCBlKVxuICAgICAgICAgICAgICAgIGNiKG51bGwsIHhoci5yZXNwb25zZVRleHQpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgeGhyLm9wZW4oXCJHRVRcIiwgdXJsKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQXV0aG9yaXphdGlvblwiLCBcIkJhc2ljIFwiK25ldyBCdWZmZXIob3B0cy51c2VybmFtZStcIjpcIitvcHRzLnBhc3N3b3JkKS50b1N0cmluZygnYmFzZTY0JykpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgXCJCYXNpYyBcIitidG9hKG9wdHMudXNlcm5hbWUrXCI6XCIrb3B0cy5wYXNzd29yZCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgeGhyLnNlbmQoZGF0YSk7XG4gICAgfSxcblxuICAgIGNhblRyeUxvZ2luICgpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdTUEFDRURPR19DUkVERU5USUFMU19UT0tFTicpIT11bmRlZmluZWQgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ1NQQUNFRE9HX0NSRURFTlRJQUxTX1RPS0VOJykhPW51bGxcbiAgICB9XG59IiwiaW1wb3J0IFVybEJ1aWxkZXIgZnJvbSAnLi91cmxCdWlsZGVyLmpzJ1xuXG5leHBvcnQgZGVmYXVsdCB7XG5cbiAgICAvKipcbiAgICAgKiBvcHRzIDogeyB0eXBlOnN0cmluZyB9XG4gICAgICogY2IgOiBjYWxsYmFjayBmdW5jdGlvblxuICAgICAqL1xuICAgIHNlYXJjaCAob3B0cywgY2IpIHtcblxuICAgICAgICB2YXIgZGF0YSA9IEpTT04uc3RyaW5naWZ5KHt9KTtcblxuICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cbiAgICAgICAgdmFyIHVybCA9IFVybEJ1aWxkZXIuZm9yU2VhcmNoKG9wdHMudHlwZSk7XG5cbiAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY2IobnVsbCwgSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KSlcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBjYihudWxsLCB4aHIucmVzcG9uc2VUZXh0KVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHhoci5vcGVuKFwiUE9TVFwiLCB1cmwpO1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcImNvbnRlbnQtdHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgIC8vIFRFU1QsIHRvIHJlbW92ZSBhZnRlciB3ZSBjYW4gdXBkYXRlIGFjbCAoc2VlIGlzc3VlIGh0dHBzOi8vZ2l0aHViLmNvbS9zcGFjZWRvZy1pby9zcGFjZWRvZy1zZXJ2ZXIvaXNzdWVzLzU0KVxuICAgICAgICAvL3hoci5zZXRSZXF1ZXN0SGVhZGVyKFwiYXV0aG9yaXphdGlvblwiLCBcIkJhc2ljIFpIVnRiWGxpWVdOclpXNWtPbWhwSUdSMWJXMTVZbUZqYTJWdVpBPT1cIik7XG5cbiAgICAgICAgeGhyLnNlbmQoZGF0YSk7XG5cbiAgICB9XG59IiwiXG5cbmltcG9ydCBDb25maWcgZnJvbSAnLi9saWIvY29uZmlnLmpzJ1xuaW1wb3J0IENyZWRlbnRpYWxzIGZyb20gJy4vbGliL2NyZWRlbnRpYWxzLmpzJ1xuaW1wb3J0IERhdGEgZnJvbSAnLi9saWIvZGF0YS5qcydcblxuXG52YXIgU3BhY2VEb2cgPSB7XG4gICAgaW5pdGlhbGl6ZSAoYmFja2VuZElkKSB7XG4gICAgICAgIGlmIChiYWNrZW5kSWQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBcIkJhY2tlbmRJZCBpcyByZXF1aXJlZC5cIlxuICAgICAgICB9XG4gICAgICAgIENvbmZpZy5iYWNrZW5kSWQgPSBiYWNrZW5kSWRcbiAgICB9LFxuICAgIFxuICAgIGdldEJhY2tlbmRJZCAoKSB7XG4gICAgICAgIHJldHVybiBDb25maWcuYmFja2VuZElkXG4gICAgfSxcblxuICAgIGZvcmdldEFsbCAoKSB7XG4gICAgICAgIENvbmZpZy5iYWNrZW5kSWQgPSBudWxsXG4gICAgICAgIENvbmZpZy5kZWZhdWx0X2F1dGhvcml6YXRpb25faGVhZGVyID0gbnVsbFxuICAgIH1cbn1cblxuXG5TcGFjZURvZy5fQ29uZmlnID0gQ29uZmlnIC8vIHBhcyBlbiByZWxlYXNlID9cblNwYWNlRG9nLkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbHNcblNwYWNlRG9nLkRhdGEgPSBEYXRhXG5cbmV4cG9ydCBkZWZhdWx0IFNwYWNlRG9nXG4iXSwibmFtZXMiOlsiQ29uZmlnIiwiYmFja2VuZElkIiwidHlwZSIsIm9wdHMiLCJjYiIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJ1cmwiLCJVcmxCdWlsZGVyIiwiZm9yTG9naW4iLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwianNvbiIsInBhcnNlIiwicmVzcG9uc2VUZXh0Iiwic3VjY2VzcyIsImRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIiLCJhY2Nlc3NUb2tlbiIsInJlbWVtYmVyTWUiLCJzZXRJdGVtIiwiZSIsIndhcm4iLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsIkJ1ZmZlciIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJ0b1N0cmluZyIsImJ0b2EiLCJzZW5kIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInVuZGVmaW5lZCIsImZvclNlYXJjaCIsIlNwYWNlRG9nIiwiX0NvbmZpZyIsIkNyZWRlbnRpYWxzIiwiRGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsYUFBZTs7ZUFFRCxJQUZDOztrQ0FJa0I7O0NBSmpDOztBQ0dBLGlCQUFlO1lBQUEsc0JBRUM7NEJBQ1VBLE9BQU9DLFNBQXpCO0tBSE87YUFBQSxxQkFP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
