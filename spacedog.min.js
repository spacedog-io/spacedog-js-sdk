(function (global, factory) {
     typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
     typeof define === 'function' && define.amd ? define(factory) :
     (global.SpaceDog = factory());
}(this, (function () { 'use strict';

var Config = {

    backendId: null,

    default_authorization_header: null

};

var qs = require('qs');

var UrlBuilder = {
    forLogin: function forLogin() {
        return 'https://' + Config.backendId + '.spacedog.io/1/login';
    },
    forSchema: function forSchema() {
        return 'https://' + Config.backendId + '.spacedog.io/1/schema';
    },
    forOneSchema: function forOneSchema(type) {
        return 'https://' + Config.backendId + '.spacedog.io/1/schema/' + type;
    },
    forSearch: function forSearch(type) {
        return 'https://' + Config.backendId + '.spacedog.io/1/search/' + type;
    },
    forCredentials: function forCredentials() {
        return 'https://' + Config.backendId + '.spacedog.io/1/credentials';
    },
    forCredentialPassword: function forCredentialPassword(id) {
        return 'https://' + Config.backendId + '.spacedog.io/1/credentials/' + id + '/password';
    },
    forData: function forData(type) {
        return 'https://' + Config.backendId + '.spacedog.io/1/data/' + type;
    },
    forDataObject: function forDataObject(type, id, opts) {
        var url = 'https://' + Config.backendId + '.spacedog.io/1/data/' + type + '/' + id;
        if (opts) {
            return url + '?' + qs.stringify(opts);
        }
        return url;
    }
};

var _xend = function _xend(method, payload, url, cb, opts) {

    var data = null;
    if (payload) {
        data = JSON.stringify(payload);
    }

    var xhr = new XMLHttpRequest();

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
            try {
                var json = JSON.parse(xhr.responseText);

                // console.log("-----\nSpaceDog.Xhr# (",xhr.url,") SUCCESS, json is : ", json, "\n------\n")

                if (json != null && (json.success == false || !(xhr.status >= 200 && xhr.status < 300))) {
                    cb(json, null);
                } else {
                    cb(null, json);
                }
            } catch (e) {
                console.warn("-----\nSpaceDog.Xhr# could not parse xhr.responseText (=", xhr.responseText, ") \n\n (xhr.url=", xhr.url, ") \n\n (xhr.method=", xhr.method, ") \n\n (xhr=", xhr, ") and therefore not able to 1/ set authorization headers 2/ remember user token, if rememberMe is true\n\nPossibly something else. Check the caught exeption:\n\n", e, "\n\n-------\n");
                cb(xhr.responseText, null);
            }
        }
    };

    xhr.open(method, url);
    xhr.setRequestHeader("content-type", "application/json;charset=UTF-8");

    if (opts && opts.authorization) {
        xhr.setRequestHeader("authorization", opts.authorization);
    } else if (Config.default_authorization_header != null) {
        xhr.setRequestHeader("authorization", Config.default_authorization_header);
    }

    if (data == null) {
        xhr.send();
    } else {
        xhr.send(data);
    }
};

var UtilXHR = {
    get: function get(url, cb) {
        _xend("GET", null, url, cb);
    },
    post: function post(payload, url, cb) {
        _xend("POST", payload, url, cb);
    },
    put: function put(payload, url, cb, opts) {
        _xend("PUT", payload, url, cb, opts);
    },
    delete: function _delete(url, cb) {
        _xend("DELETE", null, url, cb);
    }
};

var Credentials = {
    /**
     * opts : { username:string, password:string, rememberMe:bool }
     * cb : callback function
     */
    login: function login(opts, cb) {

        try {
            Config.default_authorization_header = "Basic " + new Buffer(opts.username + ":" + opts.password).toString('base64');
        } catch (e) {
            Config.default_authorization_header = "Basic " + btoa(opts.username + ":" + opts.password);
        }

        UtilXHR.get(UrlBuilder.forLogin(), function (err, data) {

            if (err != null) {

                Config.default_authorization_header = null;
            } else {

                Config.default_authorization_header = "Bearer " + data.accessToken;

                if (opts.rememberMe) {

                    localStorage.setItem('SPACEDOG_CREDENTIALS_TOKEN', JSON.stringify({
                        "accessToken": data.accessToken,
                        "backendId": Config.backendId
                    }));
                }
            }

            cb(err, data);
        });
    },
    loginWithSavedCredentials: function loginWithSavedCredentials(cb) {

        var saved = JSON.parse(localStorage.getItem('SPACEDOG_CREDENTIALS_TOKEN'));

        Config.backendId = saved.backendId;

        Config.default_authorization_header = "Bearer " + saved.accessToken;

        UtilXHR.get(UrlBuilder.forLogin(), function (err, data) {

            if (err == null) {

                Config.default_authorization_header = "Bearer " + data.accessToken;
            }

            cb(err, data);
        });
    },
    createUser: function createUser(opts, cb) {

        UtilXHR.post({
            username: opts.credentials.username,
            password: opts.credentials.password,
            email: opts.credentials.email
        }, UrlBuilder.forCredentials(), function (err, data) {

            if (err == null) {

                var userPayload = opts.user.payload;

                userPayload[opts.user.credentialIdField] = data.id;

                UtilXHR.post(opts.user.payload, UrlBuilder.forData(opts.user.type), function (err, data) {
                    if (err == null) {

                        userPayload.username = opts.credentials.username;
                        userPayload.email = opts.credentials.email;
                        userPayload.meta = {
                            id: data.id
                        };

                        cb(null, userPayload);
                    } else {
                        cb(err, null);
                    }
                });
            } else {

                cb(err, null);
            }
        });
    },
    forget: function forget() {
        Config.default_authorization_header = null;
        localStorage.removeItem('SPACEDOG_CREDENTIALS_TOKEN');
    },
    getRememberedState: function getRememberedState() {
        return JSON.parse(localStorage.getItem('SPACEDOG_CREDENTIALS_TOKEN'));
    },
    canTryLogin: function canTryLogin() {
        return localStorage.getItem('SPACEDOG_CREDENTIALS_TOKEN') != undefined && localStorage.getItem('SPACEDOG_CREDENTIALS_TOKEN') != null;
    },
    updatePassword: function updatePassword(opts, cb) {

        UtilXHR.put(opts.newPassword, UrlBuilder.forCredentialPassword(opts.credentialId), function (err, data) {
            if (err == null) {
                cb(null, data);
            } else {
                cb(err, null);
            }
        }, {
            'authorization': 'Basic ' + btoa(opts.challengedUsername + ":" + opts.challengedPassword)
        });
    }
};

var classCallCheck = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

var createClass = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      Object.defineProperty(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

var PaginationSession = function () {
    function PaginationSession(from, size) {
        classCallCheck(this, PaginationSession);

        this._from = from;
        this._size = size;
        this._total = null;
    }

    createClass(PaginationSession, [{
        key: "isNextPageAvailable",
        value: function isNextPageAvailable() {
            if (this._total == null) {
                return true;
            }
            return this._from + this._size < this._total;
        }
    }, {
        key: "isPrevPageAvailable",
        value: function isPrevPageAvailable() {
            if (this._total == null) {
                return false;
            }
            return this._from >= this._size;
        }
    }, {
        key: "_newPageLoaded",
        value: function _newPageLoaded(result) {
            this._total = result.total;
        }
    }, {
        key: "pointNextPage",
        value: function pointNextPage() {
            this._from += this._size;
        }
    }, {
        key: "pointPrevPage",
        value: function pointPrevPage() {
            this._from -= this._size;
        }
    }, {
        key: "getFrom",
        value: function getFrom() {
            return this._from;
        }
    }, {
        key: "getSize",
        value: function getSize() {
            return this._size;
        }
    }]);
    return PaginationSession;
}();

var Object$1 = function () {
  function Object(type, id, payload) {
    classCallCheck(this, Object);

    this._type = type;
    this._id = id;
    this._payload = payload;
  }

  createClass(Object, [{
    key: 'create',
    value: function create(cb) {
      var ret = this._payload;
      UtilXHR.post(this._payload, UrlBuilder.forData(this._type), function (err, data) {

        if (data) {
          ret.meta = {
            id: data.id
          };
        }

        cb(err, ret);
      });
    }
  }, {
    key: 'update',
    value: function update(cb, opts) {
      UtilXHR.put(this._payload, UrlBuilder.forDataObject(this._type, this._id, opts), cb);
    }
  }, {
    key: 'delete',
    value: function _delete(cb) {
      UtilXHR.delete(UrlBuilder.forDataObject(this._type, this._id), cb);
    }
  }]);
  return Object;
}();

var Data = {

    PaginationSession: PaginationSession,

    buildObject: function buildObject(type, id, payload) {
        return new Object$1(type, id, payload);
    },


    /**
     * opts : { type:string }
     * cb : callback function
     * paginationSession : optional paginationSession
     */
    search: function search(opts, cb, paginationSession) {

        if (opts.payload == undefined) {
            opts.payload = {};
        }

        if (paginationSession) {

            opts.payload.from = paginationSession.getFrom(), opts.payload.size = paginationSession.getSize();
        }

        UtilXHR.post(opts.payload, UrlBuilder.forSearch(opts.type), function (err, data) {
            if (err != null) {
                cb(err, data);
            } else {

                if (paginationSession) paginationSession._newPageLoaded(data);

                cb(err, data);
            }
        });
    }
};

var Schema = {

  /**
   * cb : callback function
   */
  list: function list(cb) {

    UtilXHR.get(UrlBuilder.forSchema(), cb);
  },


  /**
   * type : string, the name of the schema
   * schemaDef : content for the new schema : _acl and other elastic search attributes
   * cb : callback function
   */
  create: function create(type, schemaDef, cb) {

    var payload = {};
    payload[type] = schemaDef;

    UtilXHR.post(payload, UrlBuilder.forOneSchema(type), cb);
  }
};

var DataPermission = {

     all: ['create', 'read', 'read_all', 'search', 'update', 'update_all', 'delete', 'delete_all'],

     default_admin: ['create', 'search', 'update_all', 'delete_all'],

     default_user: ['create', 'search', 'update', 'delete'],

     default_key: ['read_all']

};

var DataTypes = [{
  name: 'string'
}, {
  name: 'boolean'
}];

var SpaceDog = {
    initialize: function initialize(backendId) {
        if (backendId == undefined) {
            throw "BackendId is required.";
        }
        Config.backendId = backendId;
    },
    getBackendId: function getBackendId() {
        return Config.backendId;
    },
    forgetAll: function forgetAll() {
        Config.backendId = null;
        Config.default_authorization_header = null;
    }
};

SpaceDog._Config = Config; // pas en release ?
SpaceDog.Credentials = Credentials;
SpaceDog.Data = Data;
SpaceDog.Schema = Schema;
SpaceDog.DataPermission = DataPermission;
SpaceDog.DataTypes = DataTypes;

return SpaceDog;

})));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjpudWxsLCJzb3VyY2VzIjpbInNyYy9saWIvY29uZmlnLmpzIiwic3JjL2xpYi91cmxCdWlsZGVyLmpzIiwic3JjL2xpYi91dGlsWGhyLmpzIiwic3JjL2xpYi9jcmVkZW50aWFscy5qcyIsInNyYy9saWIvcGFnaW5hdGlvblNlc3Npb24uanMiLCJzcmMvbGliL29iamVjdC5qcyIsInNyYy9saWIvZGF0YS5qcyIsInNyYy9saWIvc2NoZW1hLmpzIiwic3JjL2xpYi9kYXRhUGVybWlzc2lvbi5qcyIsInNyYy9saWIvZGF0YVR5cGVzLmpzIiwic3JjL3NwYWNlZG9nLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IHtcblxuICAgIGJhY2tlbmRJZDpudWxsLFxuXG4gICAgZGVmYXVsdF9hdXRob3JpemF0aW9uX2hlYWRlcjpudWxsXG5cbn0iLCJpbXBvcnQgQ29uZmlnIGZyb20gJy4vY29uZmlnLmpzJ1xudmFyIHFzID0gcmVxdWlyZSgncXMnKTtcblxuZXhwb3J0IGRlZmF1bHQge1xuXG4gICAgZm9yTG9naW4gKCkge1xuICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHtDb25maWcuYmFja2VuZElkfS5zcGFjZWRvZy5pby8xL2xvZ2luYFxuICAgIH0sXG5cbiAgICBmb3JTY2hlbWEgKCkge1xuICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHtDb25maWcuYmFja2VuZElkfS5zcGFjZWRvZy5pby8xL3NjaGVtYWAgIFxuICAgIH0sXG5cbiAgICBmb3JPbmVTY2hlbWEgKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGBodHRwczovLyR7Q29uZmlnLmJhY2tlbmRJZH0uc3BhY2Vkb2cuaW8vMS9zY2hlbWEvJHt0eXBlfWAgIFxuICAgIH0sXG5cbiAgICBmb3JTZWFyY2ggKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGBodHRwczovLyR7Q29uZmlnLmJhY2tlbmRJZH0uc3BhY2Vkb2cuaW8vMS9zZWFyY2gvJHt0eXBlfWBcbiAgICB9LFxuXG4gICAgZm9yQ3JlZGVudGlhbHMgKCkge1xuICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHtDb25maWcuYmFja2VuZElkfS5zcGFjZWRvZy5pby8xL2NyZWRlbnRpYWxzYFxuICAgIH0sXG5cbiAgICBmb3JDcmVkZW50aWFsUGFzc3dvcmQgKGlkKSB7XG4gICAgICAgIHJldHVybiBgaHR0cHM6Ly8ke0NvbmZpZy5iYWNrZW5kSWR9LnNwYWNlZG9nLmlvLzEvY3JlZGVudGlhbHMvJHtpZH0vcGFzc3dvcmRgXG4gICAgfSxcblxuICAgIGZvckRhdGEgKHR5cGUpIHtcbiAgICAgICAgcmV0dXJuIGBodHRwczovLyR7Q29uZmlnLmJhY2tlbmRJZH0uc3BhY2Vkb2cuaW8vMS9kYXRhLyR7dHlwZX1gXG4gICAgfSxcblxuICAgIGZvckRhdGFPYmplY3QgKHR5cGUsIGlkLCBvcHRzKSB7XG4gICAgICAgIHZhciB1cmwgPSBgaHR0cHM6Ly8ke0NvbmZpZy5iYWNrZW5kSWR9LnNwYWNlZG9nLmlvLzEvZGF0YS8ke3R5cGV9LyR7aWR9YFxuICAgICAgICBpZiAob3B0cykge1xuICAgICAgICAgICAgcmV0dXJuIGAke3VybH0/JHtxcy5zdHJpbmdpZnkob3B0cyl9YFxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1cmxcbiAgICB9LFxuXG59IiwiaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZydcblxudmFyIF94ZW5kID0gZnVuY3Rpb24obWV0aG9kLCBwYXlsb2FkLCB1cmwsIGNiLCBvcHRzKXtcblxuICAgIHZhciBkYXRhID0gbnVsbDtcbiAgICBpZiAocGF5bG9hZCkge1xuICAgICAgICBkYXRhID0gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCk7XG4gICAgfVxuXG4gICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuXG4gICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpO1xuXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIi0tLS0tXFxuU3BhY2VEb2cuWGhyIyAoXCIseGhyLnVybCxcIikgU1VDQ0VTUywganNvbiBpcyA6IFwiLCBqc29uLCBcIlxcbi0tLS0tLVxcblwiKVxuXG4gICAgICAgICAgICBpZiAoanNvbiAhPSBudWxsICYmIChqc29uLnN1Y2Nlc3M9PWZhbHNlIHx8ICEoeGhyLnN0YXR1cyA+PSAyMDAgJiYgeGhyLnN0YXR1cyA8IDMwMCApKSkge1xuICAgICAgICAgICAgICAgIGNiKGpzb24sIG51bGwpXG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2IobnVsbCwganNvbilcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCItLS0tLVxcblNwYWNlRG9nLlhociMgY291bGQgbm90IHBhcnNlIHhoci5yZXNwb25zZVRleHQgKD1cIix4aHIucmVzcG9uc2VUZXh0LFwiKSBcXG5cXG4gKHhoci51cmw9XCIseGhyLnVybCxcIikgXFxuXFxuICh4aHIubWV0aG9kPVwiLHhoci5tZXRob2QsXCIpIFxcblxcbiAoeGhyPVwiLHhocixcIikgYW5kIHRoZXJlZm9yZSBub3QgYWJsZSB0byAxLyBzZXQgYXV0aG9yaXphdGlvbiBoZWFkZXJzIDIvIHJlbWVtYmVyIHVzZXIgdG9rZW4sIGlmIHJlbWVtYmVyTWUgaXMgdHJ1ZVxcblxcblBvc3NpYmx5IHNvbWV0aGluZyBlbHNlLiBDaGVjayB0aGUgY2F1Z2h0IGV4ZXB0aW9uOlxcblxcblwiLCBlLFwiXFxuXFxuLS0tLS0tLVxcblwiKVxuICAgICAgICAgICAgY2IoeGhyLnJlc3BvbnNlVGV4dCwgbnVsbClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsKTtcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcImNvbnRlbnQtdHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD1VVEYtOFwiKTtcblxuICAgIGlmIChvcHRzICYmIG9wdHMuYXV0aG9yaXphdGlvbikge1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcImF1dGhvcml6YXRpb25cIiwgb3B0cy5hdXRob3JpemF0aW9uKVxuICAgIH0gZWxzZSBpZiAoQ29uZmlnLmRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIgIT0gbnVsbCkge1xuICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcImF1dGhvcml6YXRpb25cIiwgQ29uZmlnLmRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIpXG4gICAgfVxuXG4gICAgaWYgKGRhdGEgPT0gbnVsbCkge1xuICAgICAgICB4aHIuc2VuZCgpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgeGhyLnNlbmQoZGF0YSk7XG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgICBnZXQgKHVybCwgY2IpIHtcbiAgICAgICAgX3hlbmQoXCJHRVRcIiwgbnVsbCwgdXJsLCBjYilcbiAgICB9LFxuXG4gICAgcG9zdCAocGF5bG9hZCwgdXJsLCBjYikge1xuICAgICAgICBfeGVuZChcIlBPU1RcIiwgcGF5bG9hZCwgdXJsLCBjYilcbiAgICB9LFxuXG4gICAgcHV0IChwYXlsb2FkLCB1cmwsIGNiLCBvcHRzKSB7XG4gICAgICAgIF94ZW5kKFwiUFVUXCIsIHBheWxvYWQsIHVybCwgY2IsIG9wdHMpXG4gICAgfSxcblxuICAgIGRlbGV0ZSAodXJsLCBjYikge1xuICAgICAgICBfeGVuZChcIkRFTEVURVwiLCBudWxsLCB1cmwsIGNiKVxuICAgIH0sXG59IiwiaW1wb3J0IFVybEJ1aWxkZXIgZnJvbSAnLi91cmxCdWlsZGVyLmpzJ1xuaW1wb3J0IENvbmZpZyBmcm9tICcuL2NvbmZpZy5qcydcbmltcG9ydCBVdGlsWEhSIGZyb20gJy4vdXRpbFhocidcblxuZXhwb3J0IGRlZmF1bHQge1xuICAgIC8qKlxuICAgICAqIG9wdHMgOiB7IHVzZXJuYW1lOnN0cmluZywgcGFzc3dvcmQ6c3RyaW5nLCByZW1lbWJlck1lOmJvb2wgfVxuICAgICAqIGNiIDogY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgKi9cbiAgICBsb2dpbiAob3B0cywgY2IpIHtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgQ29uZmlnLmRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIgPSBcIkJhc2ljIFwiK25ldyBCdWZmZXIob3B0cy51c2VybmFtZStcIjpcIitvcHRzLnBhc3N3b3JkKS50b1N0cmluZygnYmFzZTY0JylcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgQ29uZmlnLmRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIgPSBcIkJhc2ljIFwiK2J0b2Eob3B0cy51c2VybmFtZStcIjpcIitvcHRzLnBhc3N3b3JkKVxuICAgICAgICB9XG5cbiAgICAgICAgVXRpbFhIUi5nZXQoVXJsQnVpbGRlci5mb3JMb2dpbigpLCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcblxuICAgICAgICAgICAgaWYgKGVyciAhPSBudWxsKSB7XG5cbiAgICAgICAgICAgICAgICBDb25maWcuZGVmYXVsdF9hdXRob3JpemF0aW9uX2hlYWRlciA9IG51bGwgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICBDb25maWcuZGVmYXVsdF9hdXRob3JpemF0aW9uX2hlYWRlciA9IFwiQmVhcmVyIFwiK2RhdGEuYWNjZXNzVG9rZW5cblxuICAgICAgICAgICAgICAgIGlmIChvcHRzLnJlbWVtYmVyTWUpIHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnU1BBQ0VET0dfQ1JFREVOVElBTFNfVE9LRU4nLCBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgICAgICAgIFwiYWNjZXNzVG9rZW5cIjpkYXRhLmFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgICAgICAgICBcImJhY2tlbmRJZFwiOkNvbmZpZy5iYWNrZW5kSWRcbiAgICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2IoZXJyLCBkYXRhKVxuXG4gICAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgbG9naW5XaXRoU2F2ZWRDcmVkZW50aWFscyAoY2IpICB7XG5cbiAgICAgICAgdmFyIHNhdmVkID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnU1BBQ0VET0dfQ1JFREVOVElBTFNfVE9LRU4nKSlcblxuICAgICAgICBDb25maWcuYmFja2VuZElkID0gc2F2ZWQuYmFja2VuZElkXG5cbiAgICAgICAgQ29uZmlnLmRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIgPSBcIkJlYXJlciBcIitzYXZlZC5hY2Nlc3NUb2tlblxuXG4gICAgICAgIFV0aWxYSFIuZ2V0KFVybEJ1aWxkZXIuZm9yTG9naW4oKSwgZnVuY3Rpb24oZXJyLCBkYXRhKSB7XG5cbiAgICAgICAgICAgIGlmIChlcnIgPT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgQ29uZmlnLmRlZmF1bHRfYXV0aG9yaXphdGlvbl9oZWFkZXIgPSBcIkJlYXJlciBcIitkYXRhLmFjY2Vzc1Rva2VuXG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY2IoZXJyLCBkYXRhKVxuXG4gICAgICAgIH0pXG5cbiAgICB9LFxuXG4gICAgY3JlYXRlVXNlciAob3B0cywgY2IpIHtcblxuICAgICAgICBVdGlsWEhSLnBvc3Qoe1xuICAgICAgICAgICAgICAgIHVzZXJuYW1lOiBvcHRzLmNyZWRlbnRpYWxzLnVzZXJuYW1lLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBvcHRzLmNyZWRlbnRpYWxzLnBhc3N3b3JkLFxuICAgICAgICAgICAgICAgIGVtYWlsOiBvcHRzLmNyZWRlbnRpYWxzLmVtYWlsLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIFVybEJ1aWxkZXIuZm9yQ3JlZGVudGlhbHMoKSxcbiAgICAgICAgICAgIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGVyciA9PSBudWxsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHVzZXJQYXlsb2FkID0gb3B0cy51c2VyLnBheWxvYWRcblxuICAgICAgICAgICAgICAgICAgICB1c2VyUGF5bG9hZFtvcHRzLnVzZXIuY3JlZGVudGlhbElkRmllbGRdID0gZGF0YS5pZFxuXG4gICAgICAgICAgICAgICAgICAgIFV0aWxYSFIucG9zdChvcHRzLnVzZXIucGF5bG9hZCwgXG4gICAgICAgICAgICAgICAgICAgICAgICBVcmxCdWlsZGVyLmZvckRhdGEob3B0cy51c2VyLnR5cGUpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGVyciwgZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlcnIgPT0gbnVsbCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJQYXlsb2FkLnVzZXJuYW1lID0gb3B0cy5jcmVkZW50aWFscy51c2VybmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyUGF5bG9hZC5lbWFpbCA9IG9wdHMuY3JlZGVudGlhbHMuZW1haWxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlclBheWxvYWQubWV0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOmRhdGEuaWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2IgKG51bGwsIHVzZXJQYXlsb2FkKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNiIChlcnIsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBjYihlcnIsIG51bGwpO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICB9LFxuXG5cbiAgICBmb3JnZXQgKCkge1xuICAgICAgICBDb25maWcuZGVmYXVsdF9hdXRob3JpemF0aW9uX2hlYWRlciA9IG51bGxcbiAgICAgICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ1NQQUNFRE9HX0NSRURFTlRJQUxTX1RPS0VOJylcbiAgICB9LFxuXG4gICAgZ2V0UmVtZW1iZXJlZFN0YXRlICgpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ1NQQUNFRE9HX0NSRURFTlRJQUxTX1RPS0VOJykpXG4gICAgfSxcblxuICAgIGNhblRyeUxvZ2luICgpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdTUEFDRURPR19DUkVERU5USUFMU19UT0tFTicpIT11bmRlZmluZWQgJiYgbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ1NQQUNFRE9HX0NSRURFTlRJQUxTX1RPS0VOJykhPW51bGxcbiAgICB9LFxuXG5cbiAgICB1cGRhdGVQYXNzd29yZCAob3B0cywgY2IpIHtcblxuXG4gICAgICAgIFV0aWxYSFIucHV0KG9wdHMubmV3UGFzc3dvcmQsIFVybEJ1aWxkZXIuZm9yQ3JlZGVudGlhbFBhc3N3b3JkKG9wdHMuY3JlZGVudGlhbElkKSwgZnVuY3Rpb24oZXJyLCBkYXRhKXtcbiAgICAgICAgICAgIGlmIChlcnIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNiKG51bGwsIGRhdGEpXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNiKGVyciwgbnVsbClcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LCB7XG4gICAgICAgICAgICAnYXV0aG9yaXphdGlvbic6ICdCYXNpYyAnK2J0b2Eob3B0cy5jaGFsbGVuZ2VkVXNlcm5hbWUrXCI6XCIrb3B0cy5jaGFsbGVuZ2VkUGFzc3dvcmQpXG4gICAgICAgIH0pXG5cbiAgICB9XG59IiwiXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQYWdpbmF0aW9uU2Vzc2lvbiB7XG5cbiAgICBjb25zdHJ1Y3RvciAoZnJvbSwgc2l6ZSkge1xuICAgICAgICB0aGlzLl9mcm9tID0gZnJvbVxuICAgICAgICB0aGlzLl9zaXplID0gc2l6ZVxuICAgICAgICB0aGlzLl90b3RhbCA9IG51bGxcbiAgICB9XG5cbiAgICBpc05leHRQYWdlQXZhaWxhYmxlICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RvdGFsID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb20gKyB0aGlzLl9zaXplIDwgdGhpcy5fdG90YWxcbiAgICB9XG5cblxuICAgIGlzUHJldlBhZ2VBdmFpbGFibGUgKCkge1xuICAgICAgICBpZiAodGhpcy5fdG90YWwgPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb20gPj0gdGhpcy5fc2l6ZVxuICAgIH1cblxuICAgIF9uZXdQYWdlTG9hZGVkIChyZXN1bHQpIHtcbiAgICAgICAgdGhpcy5fdG90YWwgPSByZXN1bHQudG90YWxcbiAgICB9XG5cbiAgICBwb2ludE5leHRQYWdlICgpIHtcbiAgICAgICAgdGhpcy5fZnJvbSArPSB0aGlzLl9zaXplXG4gICAgfVxuXG4gICAgcG9pbnRQcmV2UGFnZSAoKSB7XG4gICAgICAgIHRoaXMuX2Zyb20gLT0gdGhpcy5fc2l6ZVxuICAgIH1cblxuICAgIGdldEZyb20gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZnJvbVxuICAgIH1cblxuICAgIGdldFNpemUgKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fc2l6ZVxuICAgIH1cblxufSIsImltcG9ydCBVcmxCdWlsZGVyIGZyb20gJy4vdXJsQnVpbGRlcidcbmltcG9ydCBVdGlsWEhSIGZyb20gJy4vdXRpbFhocidcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT2JqZWN0IHtcblxuICBjb25zdHJ1Y3RvciAodHlwZSwgaWQsIHBheWxvYWQpIHtcbiAgICB0aGlzLl90eXBlID0gdHlwZVxuICAgIHRoaXMuX2lkID0gaWRcbiAgICB0aGlzLl9wYXlsb2FkID0gcGF5bG9hZFxuICB9XG5cbiAgY3JlYXRlIChjYikge1xuICAgIHZhciByZXQgPSB0aGlzLl9wYXlsb2FkO1xuICAgIFV0aWxYSFIucG9zdCh0aGlzLl9wYXlsb2FkLCBVcmxCdWlsZGVyLmZvckRhdGEodGhpcy5fdHlwZSksIGZ1bmN0aW9uKGVyciwgZGF0YSl7XG5cbiAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgIHJldC5tZXRhID0ge1xuICAgICAgICAgIGlkOiBkYXRhLmlkXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY2IoZXJyLCByZXQpXG4gICAgfSk7XG4gIH1cblxuICB1cGRhdGUgKGNiLCBvcHRzKSB7XG4gICAgVXRpbFhIUi5wdXQodGhpcy5fcGF5bG9hZCwgVXJsQnVpbGRlci5mb3JEYXRhT2JqZWN0KHRoaXMuX3R5cGUsIHRoaXMuX2lkLCBvcHRzKSwgY2IpXG4gIH1cblxuICBkZWxldGUgKGNiKSB7XG4gICAgVXRpbFhIUi5kZWxldGUoVXJsQnVpbGRlci5mb3JEYXRhT2JqZWN0KHRoaXMuX3R5cGUsIHRoaXMuX2lkKSwgY2IpXG4gIH1cblxufSIsImltcG9ydCBVcmxCdWlsZGVyIGZyb20gJy4vdXJsQnVpbGRlcidcbmltcG9ydCBVdGlsWEhSIGZyb20gJy4vdXRpbFhocidcbmltcG9ydCBQYWdpbmF0aW9uU2Vzc2lvbiBmcm9tICcuL3BhZ2luYXRpb25TZXNzaW9uJ1xuaW1wb3J0IE9iamVjdCBmcm9tICcuL29iamVjdCdcblxudmFyIERhdGEgPSB7XG4gICAgXG4gICAgUGFnaW5hdGlvblNlc3Npb24sXG5cbiAgICBidWlsZE9iamVjdCAodHlwZSwgaWQsIHBheWxvYWQpIHtcbiAgICAgIHJldHVybiBuZXcgT2JqZWN0ICh0eXBlLCBpZCwgcGF5bG9hZClcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogb3B0cyA6IHsgdHlwZTpzdHJpbmcgfVxuICAgICAqIGNiIDogY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgKiBwYWdpbmF0aW9uU2Vzc2lvbiA6IG9wdGlvbmFsIHBhZ2luYXRpb25TZXNzaW9uXG4gICAgICovXG4gICAgc2VhcmNoIChvcHRzLCBjYiwgcGFnaW5hdGlvblNlc3Npb24pIHtcblxuICAgICAgICBpZiAob3B0cy5wYXlsb2FkID09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgb3B0cy5wYXlsb2FkID0ge31cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwYWdpbmF0aW9uU2Vzc2lvbikge1xuXG4gICAgICAgICAgICBvcHRzLnBheWxvYWQuZnJvbSA9IHBhZ2luYXRpb25TZXNzaW9uLmdldEZyb20oKSxcbiAgICAgICAgICAgIG9wdHMucGF5bG9hZC5zaXplID0gcGFnaW5hdGlvblNlc3Npb24uZ2V0U2l6ZSgpXG5cbiAgICAgICAgfVxuXG4gICAgICAgIFV0aWxYSFIucG9zdChvcHRzLnBheWxvYWQsIFVybEJ1aWxkZXIuZm9yU2VhcmNoKG9wdHMudHlwZSksIGZ1bmN0aW9uKGVyciwgZGF0YSl7XG4gICAgICAgICAgICBpZiAoZXJyICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjYihlcnIsIGRhdGEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIGlmIChwYWdpbmF0aW9uU2Vzc2lvbilcbiAgICAgICAgICAgICAgICAgICAgcGFnaW5hdGlvblNlc3Npb24uX25ld1BhZ2VMb2FkZWQoZGF0YSlcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBjYihlcnIsIGRhdGEpXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IERhdGEiLCJpbXBvcnQgVXJsQnVpbGRlciBmcm9tICcuL3VybEJ1aWxkZXIuanMnXG5pbXBvcnQgVXRpbFhIUiBmcm9tICcuL3V0aWxYaHIuanMnXG5cbmV4cG9ydCBkZWZhdWx0IHtcblxuICAgIC8qKlxuICAgICAqIGNiIDogY2FsbGJhY2sgZnVuY3Rpb25cbiAgICAgKi9cbiAgICBsaXN0IChjYikge1xuXG4gICAgICBVdGlsWEhSLmdldChVcmxCdWlsZGVyLmZvclNjaGVtYSgpLCBjYilcblxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiB0eXBlIDogc3RyaW5nLCB0aGUgbmFtZSBvZiB0aGUgc2NoZW1hXG4gICAgICogc2NoZW1hRGVmIDogY29udGVudCBmb3IgdGhlIG5ldyBzY2hlbWEgOiBfYWNsIGFuZCBvdGhlciBlbGFzdGljIHNlYXJjaCBhdHRyaWJ1dGVzXG4gICAgICogY2IgOiBjYWxsYmFjayBmdW5jdGlvblxuICAgICAqL1xuICAgIGNyZWF0ZSAodHlwZSwgc2NoZW1hRGVmLCBjYikge1xuXG4gICAgICB2YXIgcGF5bG9hZCA9IHt9O1xuICAgICAgcGF5bG9hZFt0eXBlXSA9IHNjaGVtYURlZjtcblxuICAgICAgVXRpbFhIUi5wb3N0KHBheWxvYWQsIFVybEJ1aWxkZXIuZm9yT25lU2NoZW1hKHR5cGUpLCBjYik7XG5cbiAgICB9LFxufSIsIlxuZXhwb3J0IGRlZmF1bHQge1xuICBcbiAgYWxsOiBbJ2NyZWF0ZScsXG4gICAgICAgJ3JlYWQnLFxuICAgICAgICdyZWFkX2FsbCcsXG4gICAgICAgJ3NlYXJjaCcsXG4gICAgICAgJ3VwZGF0ZScsXG4gICAgICAgJ3VwZGF0ZV9hbGwnLFxuICAgICAgICdkZWxldGUnLFxuICAgICAgICdkZWxldGVfYWxsJ10sXG5cbiAgZGVmYXVsdF9hZG1pbjogWydjcmVhdGUnLCAnc2VhcmNoJywgJ3VwZGF0ZV9hbGwnLCAnZGVsZXRlX2FsbCddLFxuXG4gIGRlZmF1bHRfdXNlcjogWydjcmVhdGUnLCAnc2VhcmNoJywgJ3VwZGF0ZScsICdkZWxldGUnXSxcblxuICBkZWZhdWx0X2tleTogWydyZWFkX2FsbCddLFxuXG59IiwiZXhwb3J0IGRlZmF1bHQgW3tcbiAgICBuYW1lOidzdHJpbmcnLFxuICB9LHtcbiAgICBuYW1lOidib29sZWFuJyxcbiAgfV07IiwiXG5pbXBvcnQgQ29uZmlnIGZyb20gJy4vbGliL2NvbmZpZy5qcydcbmltcG9ydCBDcmVkZW50aWFscyBmcm9tICcuL2xpYi9jcmVkZW50aWFscy5qcydcbmltcG9ydCBEYXRhIGZyb20gJy4vbGliL2RhdGEuanMnXG5pbXBvcnQgU2NoZW1hIGZyb20gJy4vbGliL3NjaGVtYS5qcydcbmltcG9ydCBEYXRhUGVybWlzc2lvbiBmcm9tICcuL2xpYi9kYXRhUGVybWlzc2lvbi5qcydcbmltcG9ydCBEYXRhVHlwZXMgZnJvbSAnLi9saWIvZGF0YVR5cGVzLmpzJ1xuXG52YXIgU3BhY2VEb2cgPSB7XG4gICAgaW5pdGlhbGl6ZSAoYmFja2VuZElkKSB7XG4gICAgICAgIGlmIChiYWNrZW5kSWQgPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aHJvdyBcIkJhY2tlbmRJZCBpcyByZXF1aXJlZC5cIlxuICAgICAgICB9XG4gICAgICAgIENvbmZpZy5iYWNrZW5kSWQgPSBiYWNrZW5kSWRcbiAgICB9LFxuICAgIFxuICAgIGdldEJhY2tlbmRJZCAoKSB7XG4gICAgICAgIHJldHVybiBDb25maWcuYmFja2VuZElkXG4gICAgfSxcblxuICAgIGZvcmdldEFsbCAoKSB7XG4gICAgICAgIENvbmZpZy5iYWNrZW5kSWQgPSBudWxsXG4gICAgICAgIENvbmZpZy5kZWZhdWx0X2F1dGhvcml6YXRpb25faGVhZGVyID0gbnVsbFxuICAgIH1cbn1cblxuXG5TcGFjZURvZy5fQ29uZmlnID0gQ29uZmlnIC8vIHBhcyBlbiByZWxlYXNlID9cblNwYWNlRG9nLkNyZWRlbnRpYWxzID0gQ3JlZGVudGlhbHNcblNwYWNlRG9nLkRhdGEgPSBEYXRhXG5TcGFjZURvZy5TY2hlbWEgPSBTY2hlbWFcblNwYWNlRG9nLkRhdGFQZXJtaXNzaW9uID0gRGF0YVBlcm1pc3Npb25cblNwYWNlRG9nLkRhdGFUeXBlcyA9IERhdGFUeXBlc1xuXG5leHBvcnQgZGVmYXVsdCBTcGFjZURvZ1xuIl0sIm5hbWVzIjpbInFzIiwicmVxdWlyZSIsIkNvbmZpZyIsImJhY2tlbmRJZCIsInR5cGUiLCJpZCIsIm9wdHMiLCJ1cmwiLCJzdHJpbmdpZnkiLCJfeGVuZCIsIm1ldGhvZCIsInBheWxvYWQiLCJjYiIsImRhdGEiLCJKU09OIiwieGhyIiwiWE1MSHR0cFJlcXVlc3QiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwianNvbiIsInBhcnNlIiwicmVzcG9uc2VUZXh0Iiwic3VjY2VzcyIsInN0YXR1cyIsImUiLCJ3YXJuIiwib3BlbiIsInNldFJlcXVlc3RIZWFkZXIiLCJhdXRob3JpemF0aW9uIiwiZGVmYXVsdF9hdXRob3JpemF0aW9uX2hlYWRlciIsInNlbmQiLCJCdWZmZXIiLCJ1c2VybmFtZSIsInBhc3N3b3JkIiwidG9TdHJpbmciLCJidG9hIiwiZ2V0IiwiVXJsQnVpbGRlciIsImZvckxvZ2luIiwiZXJyIiwiYWNjZXNzVG9rZW4iLCJyZW1lbWJlck1lIiwic2V0SXRlbSIsInNhdmVkIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsInBvc3QiLCJjcmVkZW50aWFscyIsImVtYWlsIiwiZm9yQ3JlZGVudGlhbHMiLCJ1c2VyUGF5bG9hZCIsInVzZXIiLCJjcmVkZW50aWFsSWRGaWVsZCIsImZvckRhdGEiLCJtZXRhIiwicmVtb3ZlSXRlbSIsInVuZGVmaW5lZCIsInB1dCIsIm5ld1Bhc3N3b3JkIiwiZm9yQ3JlZGVudGlhbFBhc3N3b3JkIiwiY3JlZGVudGlhbElkIiwiY2hhbGxlbmdlZFVzZXJuYW1lIiwiY2hhbGxlbmdlZFBhc3N3b3JkIiwiUGFnaW5hdGlvblNlc3Npb24iLCJmcm9tIiwic2l6ZSIsIl9mcm9tIiwiX3NpemUiLCJfdG90YWwiLCJyZXN1bHQiLCJ0b3RhbCIsIk9iamVjdCIsIl90eXBlIiwiX2lkIiwiX3BheWxvYWQiLCJyZXQiLCJmb3JEYXRhT2JqZWN0IiwiZGVsZXRlIiwiRGF0YSIsInBhZ2luYXRpb25TZXNzaW9uIiwiZ2V0RnJvbSIsImdldFNpemUiLCJmb3JTZWFyY2giLCJfbmV3UGFnZUxvYWRlZCIsImZvclNjaGVtYSIsInNjaGVtYURlZiIsImZvck9uZVNjaGVtYSIsIlNwYWNlRG9nIiwiX0NvbmZpZyIsIkNyZWRlbnRpYWxzIiwiU2NoZW1hIiwiRGF0YVBlcm1pc3Npb24iLCJEYXRhVHlwZXMiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGFBQWU7O2VBRUQsSUFGQzs7a0NBSWtCOztDQUpqQzs7QUNDQSxJQUFJQSxLQUFLQyxRQUFRLElBQVIsQ0FBVDs7QUFFQSxpQkFBZTtZQUFBLHNCQUVDOzRCQUNVQyxPQUFPQyxTQUF6QjtLQUhPO2FBQUEsdUJBTUU7NEJBQ1NELE9BQU9DLFNBQXpCO0tBUE87Z0JBQUEsd0JBVUdDLElBVkgsRUFVUzs0QkFDRUYsT0FBT0MsU0FBekIsOEJBQTJEQyxJQUEzRDtLQVhPO2FBQUEscUJBY0FBLElBZEEsRUFjTTs0QkFDS0YsT0FBT0MsU0FBekIsOEJBQTJEQyxJQUEzRDtLQWZPO2tCQUFBLDRCQWtCTzs0QkFDSUYsT0FBT0MsU0FBekI7S0FuQk87eUJBQUEsaUNBc0JZRSxFQXRCWixFQXNCZ0I7NEJBQ0xILE9BQU9DLFNBQXpCLG1DQUFnRUUsRUFBaEU7S0F2Qk87V0FBQSxtQkEwQkZELElBMUJFLEVBMEJJOzRCQUNPRixPQUFPQyxTQUF6Qiw0QkFBeURDLElBQXpEO0tBM0JPO2lCQUFBLHlCQThCSUEsSUE5QkosRUE4QlVDLEVBOUJWLEVBOEJjQyxJQTlCZCxFQThCb0I7WUFDdkJDLG1CQUFpQkws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
